<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating an ‘Alternative FDR’ (aFDR) fixture table • fplscrapR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating an ‘Alternative FDR’ (aFDR) fixture table">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fplscrapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/afdr.html">Creating an Alternative FDR' (aFDR) ranking of opponents by FPL points allowed</a>
    </li>
    <li>
      <a href="../articles/afdrtable.html">Creating an 'Alternative FDR' (aFDR) fixture table</a>
    </li>
    <li>
      <a href="../articles/allvignettes.html">allvignettes</a>
    </li>
    <li>
      <a href="../articles/aubatransfers.html">Aubameyang ownership and net transfers for the first 25 gameweeks</a>
    </li>
    <li>
      <a href="../articles/avgfplplayercost.html">Most expensive teams by average FPL player cost</a>
    </li>
    <li>
      <a href="../articles/bpsforgame.html">Comparing total team BPS scores for a given game</a>
    </li>
    <li>
      <a href="../articles/entryscores.html">Average and top entry scores for the first 25 gameweeks</a>
    </li>
    <li>
      <a href="../articles/fdrtable.html">Creating your own 'FDR' fixture table</a>
    </li>
    <li>
      <a href="../articles/findgoalscorers.html">Finding the names of goalscorers in a given fixture</a>
    </li>
    <li>
      <a href="../articles/fixtable.html">Creating a simple fixture table</a>
    </li>
    <li>
      <a href="../articles/hazalexishist.html">Comparing historical FPL total season scores for Eden Hazard and Alexis Sanchez</a>
    </li>
    <li>
      <a href="../articles/listmyleagues.html">List your classic mini-leagues and current ranks</a>
    </li>
    <li>
      <a href="../articles/mlmostowned.html">Finding the most owned players amongst the top 20 teams of your favourite mini-league</a>
    </li>
    <li>
      <a href="../articles/mltop.html">Listing the top 20 of your favourite mini-league</a>
    </li>
    <li>
      <a href="../articles/salahpoints.html">Mohamed Salah's points in each gameweek for the first 25 gameweeks</a>
    </li>
    <li>
      <a href="../articles/simplexamodel.html">Building a very simple expected assists (xA) model</a>
    </li>
    <li>
      <a href="../articles/topperformers.html">List of top performers by FPL goals and assists</a>
    </li>
    <li>
      <a href="../articles/vizentryhist.html">Visualizing the FPL histories of entries</a>
    </li>
    <li>
      <a href="../articles/vizrankprogress.html">Visualizing your in-season Overall Rank progress</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wiscostret/fplscrapR">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Creating an ‘Alternative FDR’ (aFDR) fixture table</h1>
                        <h4 class="author">Rasmus Wiscostretford</h4>
            
            <h4 class="date">2019-03-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/wiscostret/fplscrapR/blob/master/vignettes/afdrtable.Rmd"><code>vignettes/afdrtable.Rmd</code></a></small>
      <div class="hidden name"><code>afdrtable.Rmd</code></div>

    </div>

    
    
<p>Suppose now we are interested in creating an FPL fixture table that ranks fixtures by the ‘Alternative FDR’ (aFDR) metric? Again, we take the first 25 gameweeks of the season as an example.</p>
<p>First we create the aFDR rankings table, by fetching the gameweek-by-gameweek details of ALL players using get_player_details, and then transforming that using dplyr:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(fplscrapR)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</code></pre></div>
<pre><code>## 
## Vedhæfter pakke: 'dplyr'</code></pre>
<pre><code>## De følgende objekter er maskerede fra 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## De følgende objekter er maskerede fra 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_player_details.html">get_player_details</a></span>() <span class="co"># this may take a while to load as it fetches ALL player details</span>

afdrranks &lt;-<span class="st"> </span>df %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(round %in%<span class="st"> </span><span class="dv">1</span>:<span class="dv">25</span>) %&gt;%<span class="st"> </span><span class="co"># filtering for the gameweeks we are interested in.</span>
<span class="st">  </span><span class="kw">group_by</span>(opponent_team) %&gt;%<span class="st"> </span><span class="co"># transformation to group and summarize the total_points (scored by a given player in a given round) by the opponent ('opponent_team') variable level</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(total_points)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="st">`</span><span class="dt">sum(total_points)</span><span class="st">`</span>) %&gt;%<span class="st"> </span><span class="co"># ordering (arranging) by total_points allowed</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">oppo=</span><span class="kw">recode</span>(opponent_team,<span class="st">"1"</span>=<span class="st">"ARS"</span>,<span class="st">"2"</span>=<span class="st">"BOU"</span>,<span class="st">"3"</span>=<span class="st">"BHA"</span>,<span class="st">"4"</span>=<span class="st">"BUR"</span>,<span class="st">"5"</span>=<span class="st">"CAR"</span>,<span class="st">"6"</span>=<span class="st">"CHE"</span>,<span class="st">"7"</span>=<span class="st">"CRY"</span>,<span class="st">"8"</span>=<span class="st">"EVE"</span>,<span class="st">"9"</span>=<span class="st">"FUL"</span>,<span class="st">"10"</span>=<span class="st">"HUD"</span>,<span class="st">"11"</span>=<span class="st">"LEI"</span>,<span class="st">"12"</span>=<span class="st">"LIV"</span>,<span class="st">"13"</span>=<span class="st">"MCI"</span>,<span class="st">"14"</span>=<span class="st">"MUN"</span>,<span class="st">"15"</span>=<span class="st">"NEW"</span>,<span class="st">"16"</span>=<span class="st">"SOU"</span>,<span class="st">"17"</span>=<span class="st">"TOT"</span>,<span class="st">"18"</span>=<span class="st">"WAT"</span>,<span class="st">"19"</span>=<span class="st">"WHU"</span>,<span class="st">"20"</span>=<span class="st">"WOL"</span>)) <span class="co"># here we transform the numbered team labels to the FPL short letter names</span></code></pre></div>
<p>Next, we fetch the full fixture list using get_game_list:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gamelist &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_game_list.html">get_game_list</a></span>()</code></pre></div>
<p>FPL only lists the fixtures once, as HOME-AWAY, but we need both HOME-AWAY and AWAY-HOME to plot the full fixture table. We need to plot every fixture twice, once as a home game for the one team, and once as an away game for the other team.</p>
<p>Using R base’s rbind and dplyr’s mutate (creating new variables) we essentially just duplicate the fixture table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">afdrfixtures &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(
  gamelist %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">team=</span>home,<span class="dt">oppo=</span>away,<span class="dt">homeaway=</span><span class="st">"home"</span>),
  gamelist %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">team=</span>away,<span class="dt">oppo=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/chartr">tolower</a></span>(home),<span class="dt">homeaway=</span><span class="st">"away"</span>))</code></pre></div>
<p>Then we need to add in the aFDR ranking for each fixture, doing so through a loop (which is decidedly not the most efficient method). For each row, we identify the data point in the afdrranks data frame that provides the aFDR ranking for each team in question:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for (i in <span class="dv">1</span>:<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(afdrfixtures)){
  afdrfixtures$afdr[i] &lt;-<span class="st"> </span>afdrranks$<span class="st">`</span><span class="dt">sum(total_points)</span><span class="st">`</span>[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(afdrranks$oppo==<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/chartr">toupper</a></span>(afdrfixtures$oppo[i]))]
}</code></pre></div>
<p>Next we use dplyr and ggplot2 to plot the data in a fixture table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)

afdrfixtures %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(GW %in%<span class="st"> </span><span class="dv">1</span>:<span class="dv">25</span>) %&gt;%<span class="st"> </span><span class="co"># filtering for the gameweeks we are interested in </span>
<span class="st">  </span><span class="kw">ggplot</span>() +
<span class="st">    </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x=</span>GW,<span class="dt">y=</span>team,<span class="dt">fill=</span>afdr),<span class="dt">colour=</span><span class="st">"lightgrey"</span>) +
<span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x=</span>GW,<span class="dt">y=</span>team,<span class="dt">label=</span>oppo),<span class="dt">size=</span><span class="dv">2</span>) +
<span class="st">    </span><span class="kw">theme_void</span>() +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">"bold"</span>)) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">margin=</span><span class="kw">margin</span>(<span class="dv">0</span>,-<span class="dv">20</span>,<span class="dv">0</span>,<span class="dv">0</span>))) +<span class="st"> </span><span class="co"># fixing the margins</span>
<span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">position=</span><span class="st">"top"</span>,<span class="dt">breaks=</span><span class="dv">1</span>:<span class="dv">25</span>) +
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">caption=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"Data from fplscrapR | "</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.Date</a></span>(),<span class="dt">sep=</span><span class="st">""</span>)) +
<span class="st">    </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">guide=</span>F,<span class="dt">low=</span><span class="st">"#00FF87"</span>,<span class="dt">mid=</span><span class="st">"#D6DCD8"</span>,<span class="dt">high=</span><span class="st">"#7F002D"</span>,<span class="dt">midpoint=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/median">median</a></span>(afdrfixtures$afdr)) <span class="co"># creating a gradient colour-coding that spans from lowest aFDR ranking (coloured red) to highest (coloured green)</span></code></pre></div>
<p><img src="afdrtable_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
