<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Building a very simple expected assists (xA) model • fplscrapR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Building a very simple expected assists (xA) model">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fplscrapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/afdr.html">Creating an Alternative FDR' (aFDR) ranking of opponents by FPL points allowed</a>
    </li>
    <li>
      <a href="../articles/afdrtable.html">Creating an 'Alternative FDR' (aFDR) fixture table</a>
    </li>
    <li>
      <a href="../articles/allvignettes.html">UNKNOWN TITLE</a>
    </li>
    <li>
      <a href="../articles/aubatransfers.html">Aubameyang ownership and net transfers for the first 25 gameweeks</a>
    </li>
    <li>
      <a href="../articles/avgfplplayercost.html">Most expensive teams by average FPL player cost</a>
    </li>
    <li>
      <a href="../articles/bpsforgame.html">Comparing total team BPS scores for a given game</a>
    </li>
    <li>
      <a href="../articles/dgw32ppms.html">Top options by FPL points per 90 mins</a>
    </li>
    <li>
      <a href="../articles/entryscores.html">Average and top entry scores for the first 25 gameweeks</a>
    </li>
    <li>
      <a href="../articles/fantasianplayingtime.html">Replicating Fantasian's playing time visualisation</a>
    </li>
    <li>
      <a href="../articles/fdrtable.html">Creating your own 'FDR' fixture table</a>
    </li>
    <li>
      <a href="../articles/findgoalscorers.html">Finding the names of goalscorers in a given fixture</a>
    </li>
    <li>
      <a href="../articles/fixtable.html">Creating a simple fixture table</a>
    </li>
    <li>
      <a href="../articles/hazalexishist.html">Comparing historical FPL total season scores for Mesut Özil and Alexis Sanchez</a>
    </li>
    <li>
      <a href="../articles/listmyleagues.html">List your classic mini-leagues and current ranks</a>
    </li>
    <li>
      <a href="../articles/myxpts.html">My Expected Points</a>
    </li>
    <li>
      <a href="../articles/salahpoints.html">Mohamed Salah's points in each gameweek for the first 25 gameweeks</a>
    </li>
    <li>
      <a href="../articles/simplexamodel.html">Building a very simple expected assists (xA) model</a>
    </li>
    <li>
      <a href="../articles/talismantheory.html">Replicating Who Got The Assist?'s Talisman Theory</a>
    </li>
    <li>
      <a href="../articles/topperformers.html">List of top performers by FPL goals and assists</a>
    </li>
    <li>
      <a href="../articles/vizentryhist.html">Visualizing the FPL histories of entries</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wiscostret/fplscrapR">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Building a very simple expected assists (xA) model</h1>
                        <h4 class="author">Rasmus Wiscostretford</h4>
            
            <h4 class="date">2019-08-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/wiscostret/fplscrapR/blob/master/vignettes/simplexamodel.Rmd"><code>vignettes/simplexamodel.Rmd</code></a></small>
      <div class="hidden name"><code>simplexamodel.Rmd</code></div>

    </div>

    
    
<p>Suppose we are interested in trying to build an ‘expected assists’ (xA) model from the FPL data? Again, we take the first 25 gameweeks of the 18/19 season as an example.</p>
<p>First we fetch the gameweek-by-gameweek details of ALL players using get_player_details, then create our model dataset by selected information that could predict assist performance, such as Key Passes and Open Play Crosses:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(fplscrapR)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4">df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_player_details.html">get_player_details</a></span>(<span class="dt">season=</span><span class="dv">18</span>) <span class="co"># this may take a while to load as it fetches ALL player details</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6">dfmodel &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(round <span class="op">%in%</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">25</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># filtering out the rounds we are interested in</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">potentialassists =</span> key_passes<span class="op">+</span>open_play_crosses) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># creating a new variable that give us a potential indicator for expected assists, namely the number of key passes and open play crosses for each player</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="st">  </span><span class="kw">select</span>(playername,assists,potentialassists) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># selecting the variables we need for our analysis</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="st">  </span><span class="kw">group_by</span>(playername) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># transformation to group and summarize all our variables (i.e. the actual and potential assists) at the 'playername' variable level</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="st">  </span><span class="kw">summarize_all</span>(sum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">xA=</span>potentialassists<span class="op">*</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(assists)<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(potentialassists))) <span class="co"># creating a new variable called 'xA' that attempts to predict the actual number of assists based on the relationship (from our data) between the number of assists and key passes+open play cross a player has produced</span></a></code></pre></div>
<p>Next we use dplyr and ggplot2 to transform and plot the data, comparing the actual FPL assists with our ‘xA’ model predictions. We also use the ‘ggrepel’ package to avoid cluttering of our plot:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggrepel)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">dfmodel <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>xA,<span class="dt">y=</span>assists)) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.5</span>,<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">"Expected assists"</span>,<span class="dt">y=</span><span class="st">"Actual assists"</span>,<span class="dt">title=</span><span class="st">"Expected vs. actual assists"</span>,<span class="dt">subtitle=</span><span class="st">"Season 2018/2019 - Gameweeks 1-25"</span>, <span class="dt">caption=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"Data from fplscrapR | "</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.Date</a></span>(),<span class="dt">sep=</span><span class="st">""</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept=</span><span class="dv">0</span>,<span class="dt">slope=</span><span class="dv">1</span>,<span class="dt">colour=</span><span class="st">"grey"</span>,<span class="dt">size=</span><span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">size=</span><span class="fl">3.75</span>,<span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="dt">label=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(xA<span class="op">&gt;</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/quantile">quantile</a></span>(xA,<span class="dt">prob=</span><span class="dv">1</span><span class="fl">-1.5</span><span class="op">/</span><span class="dv">100</span>),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(playername),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(assists<span class="op">&gt;</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/quantile">quantile</a></span>(assists,<span class="dt">prob=</span><span class="dv">1</span><span class="fl">-1.5</span><span class="op">/</span><span class="dv">100</span>),<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(playername),<span class="st">""</span>)))) <span class="op">+</span><span class="st"> </span><span class="co">#</span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">12</span>),<span class="dt">breaks=</span><span class="dv">0</span><span class="op">:</span><span class="dv">12</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">12</span>),<span class="dt">breaks=</span><span class="dv">0</span><span class="op">:</span><span class="dv">12</span>)</a></code></pre></div>
<p><img src="simplexamodel_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>Here we can see that there is a significant variation around our expected assists. Ryan Fraser’s ouput is, for instance, well predicted. Raheem Sterling and Leroy Sanés are not - the model firmly under-estimates their assists. Meanwhile, the assists of players like Lucas Digne and Andros Townsend are far over-estimated.</p>
<p>Finally, we test our xA model to see how it fares in explaining the variation of actual assists, using the summary function from R base:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(dfmodel,<span class="dt">formula=</span>xA <span class="op">~</span><span class="st"> </span>assists))</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = xA ~ assists, data = dfmodel)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.8933 -0.4290 -0.3280  0.2436  5.1990 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.42900    0.04669   9.189   &lt;2e-16 ***
## assists      0.58220    0.02219  26.237   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.9957 on 595 degrees of freedom
## Multiple R-squared:  0.5364, Adjusted R-squared:  0.5356 
## F-statistic: 688.4 on 1 and 595 DF,  p-value: &lt; 2.2e-16</code></pre>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
